(()=>{"use strict";(()=>{const n="http://localhost:3000",t={garage:`${n}/garage`,engine:`${n}/engine`,winners:`${n}/winners`},e={cars:[],winners:[],garagePage:1,winnersPage:1,carsCount:0,winnersCount:0,view:"garage",sort:"time",sortOrder:"asc"};function a(n="#000000"){return`<?xml version="1.0" standalone="no"?>\n  <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"\n   "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n  <svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n   width="1280.000000pt" height="640.000000pt" viewBox="0 0 1280.000000 640.000000"\n   preserveAspectRatio="xMidYMid meet">\n  <metadata>\n  Created by potrace 1.15, written by Peter Selinger 2001-2017\n  </metadata>\n  <g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)"\n  fill="${n}" stroke="none">\n  <path d="M3525 5341 c-72 -18 -79 -28 -90 -121 -4 -30 -11 -62 -16 -71 -4 -9\n  -97 -51 -206 -94 -774 -304 -1348 -540 -1603 -661 -163 -77 -222 -91 -421\n  -104 -85 -5 -170 -14 -189 -20 -101 -32 -362 -58 -620 -63 l-115 -2 -47 -80\n  c-47 -78 -47 -80 -29 -100 34 -36 35 -77 5 -177 -30 -99 -34 -178 -19 -370 5\n  -67 4 -88 -6 -88 -29 0 -83 -56 -110 -114 -50 -106 -74 -343 -48 -467 13 -58\n  13 -62 3 -159 -5 -54 16 -238 28 -244 2 -1 29 -20 61 -41 73 -49 123 -103 132\n  -143 17 -79 167 -155 355 -181 104 -15 969 -97 1087 -104 l32 -2 5 160 c7 230\n  50 394 146 559 281 479 917 673 1405 429 316 -159 530 -424 598 -742 22 -106\n  29 -365 13 -519 l-8 -82 3002 0 c2855 0 3002 1 2995 18 -33 87 -56 325 -45\n  461 28 320 177 567 459 759 399 273 847 282 1243 24 239 -157 397 -392 460\n  -687 18 -84 15 -341 -5 -430 -8 -38 -14 -71 -12 -73 7 -8 386 20 478 34 180\n  28 253 65 304 152 24 41 28 57 28 127 -1 44 -9 117 -20 163 -18 79 -18 88 -2\n  190 31 199 40 306 41 497 1 176 -1 195 -23 260 -46 135 -103 190 -283 274\n  -222 104 -633 220 -1168 330 -523 108 -1524 210 -2054 211 l-229 0 -236 139\n  c-813 477 -1593 884 -1852 966 -498 157 -1598 195 -2892 100 l-188 -14 -47 30\n  c-92 58 -223 89 -297 70z m1912 -311 c13 -45 58 -305 88 -515 33 -226 74 -539\n  71 -542 -7 -7 -1672 40 -2054 58 -357 16 -464 56 -573 215 -62 91 -87 225 -59\n  326 12 40 56 74 192 148 369 198 799 289 1618 340 246 15 290 16 510 16 l194\n  -1 13 -45z m649 10 c383 -36 717 -86 934 -139 210 -52 451 -163 720 -332 141\n  -88 379 -259 380 -271 0 -5 -14 -8 -32 -8 -48 0 -114 -37 -140 -78 -24 -39\n  -30 -113 -15 -189 l9 -43 -904 0 -904 0 -176 540 -175 540 47 0 c25 0 141 -9\n  256 -20z"/>\n  <path d="M2617 3125 c-431 -82 -774 -440 -838 -875 -17 -117 -7 -292 24 -410\n  113 -436 497 -751 947 -777 507 -29 959 313 1076 813 28 117 26 348 -4 467\n  -94 378 -383 670 -760 768 -105 27 -336 34 -445 14z m378 -310 c84 -21 209\n  -85 280 -142 116 -94 210 -242 251 -393 23 -87 24 -260 0 -355 -58 -237 -242\n  -439 -473 -519 -531 -186 -1074 277 -969 828 30 152 94 274 206 386 111 110\n  237 178 385 206 84 16 235 11 320 -11z"/>\n  <path d="M2918 2568 c2 -90 7 -167 12 -172 17 -17 108 58 201 166 l51 57 -48\n  31 c-52 33 -131 65 -185 75 l-34 6 3 -163z"/>\n  <path d="M2591 2700 c-62 -22 -167 -82 -164 -94 3 -13 237 -216 249 -216 7 0\n  15 7 18 16 8 20 8 127 -1 232 -7 95 -8 96 -102 62z"/>\n  <path d="M3209 2355 c-57 -64 -105 -123 -107 -131 -6 -25 46 -35 157 -29 58 3\n  121 8 139 11 33 5 34 6 27 42 -7 44 -64 167 -92 201 l-19 24 -105 -118z"/>\n  <path d="M2260 2409 c-31 -44 -68 -133 -77 -186 l-6 -33 155 0 c165 0 201 9\n  181 44 -13 24 -204 216 -214 216 -5 0 -22 -18 -39 -41z"/>\n  <path d="M2786 2354 c-36 -35 0 -87 44 -64 26 14 26 56 1 70 -25 13 -27 13\n  -45 -6z"/>\n  <path d="M2751 2186 c-57 -32 -68 -111 -22 -157 43 -42 101 -43 143 -1 42 42\n  41 100 -1 143 -33 32 -78 38 -120 15z"/>\n  <path d="M2560 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20\n  -54 2z"/>\n  <path d="M3002 2124 c-27 -19 -28 -36 -3 -58 25 -23 61 -6 61 29 0 33 -30 49\n  -58 29z"/>\n  <path d="M2245 1993 c-77 -6 -76 -5 -59 -65 16 -55 61 -146 92 -186 l18 -23\n  103 122 c57 67 104 129 105 138 1 14 -14 16 -104 17 -58 0 -127 -1 -155 -3z"/>\n  <path d="M3165 1981 c-44 -4 -61 -10 -63 -22 -3 -16 210 -229 228 -229 22 0\n  86 141 105 228 l7 32 -109 -2 c-59 -1 -135 -4 -168 -7z"/>\n  <path d="M2776 1914 c-19 -18 -19 -20 -6 -45 6 -11 21 -19 35 -19 20 0 45 24\n  45 44 0 10 -32 36 -45 36 -7 0 -21 -7 -29 -16z"/>\n  <path d="M2589 1743 c-86 -90 -139 -151 -139 -162 0 -25 179 -101 236 -101\n  l27 0 -7 143 c-9 166 -13 187 -35 187 -9 0 -46 -30 -82 -67z"/>\n  <path d="M2936 1801 c-6 -10 -24 -168 -29 -258 -3 -60 -2 -63 19 -63 79 0 262\n  68 248 92 -5 7 -53 64 -108 126 -93 105 -117 124 -130 103z"/>\n  <path d="M10723 3125 c-318 -58 -597 -266 -743 -555 -223 -441 -98 -996 289\n  -1288 112 -84 188 -125 311 -166 274 -91 545 -70 802 61 552 282 735 983 392\n  1500 -225 339 -651 521 -1051 448z m385 -315 c348 -98 579 -443 532 -796 -67\n  -508 -596 -796 -1055 -574 -239 116 -396 352 -412 620 -20 335 192 640 516\n  745 122 40 289 42 419 5z"/>\n  <path d="M11017 2568 c3 -90 9 -167 14 -172 13 -14 53 18 155 122 l95 97 -23\n  18 c-50 40 -189 97 -235 97 -10 0 -11 -33 -6 -162z"/>\n  <path d="M10705 2706 c-50 -16 -133 -58 -163 -82 l-23 -19 121 -107 c67 -60\n  128 -108 135 -108 23 0 27 39 20 186 -8 162 -4 157 -90 130z"/>\n  <path d="M11307 2354 c-59 -65 -107 -126 -107 -136 0 -11 11 -18 38 -22 44 -7\n  278 7 289 17 15 16 -51 183 -94 236 l-19 24 -107 -119z"/>\n  <path d="M10362 2413 c-39 -62 -70 -134 -78 -184 l-7 -39 152 0 c86 0 161 5\n  172 10 17 10 18 13 5 38 -8 15 -59 71 -114 125 l-99 99 -31 -49z"/>\n  <path d="M10888 2359 c-24 -14 -23 -56 2 -69 44 -23 80 29 44 64 -18 19 -23\n  19 -46 5z"/>\n  <path d="M10851 2187 c-49 -29 -66 -101 -35 -146 9 -13 32 -29 50 -37 29 -12\n  39 -12 68 0 99 41 85 180 -19 192 -24 3 -50 -1 -64 -9z"/>\n  <path d="M10660 2136 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20\n  -54 2z"/>\n  <path d="M11096 2124 c-9 -8 -16 -22 -16 -29 0 -13 26 -45 36 -45 20 0 44 25\n  44 45 0 14 -8 29 -19 35 -25 13 -27 13 -45 -6z"/>\n  <path d="M10335 1991 c-60 -6 -60 -6 -57 -36 9 -69 104 -248 122 -229 57 61\n  210 250 207 258 -4 12 -176 17 -272 7z"/>\n  <path d="M11267 1983 c-68 -5 -79 -19 -47 -60 23 -31 200 -193 210 -193 3 0\n  20 24 37 53 29 48 52 111 67 180 l6 27 -107 -2 c-60 -1 -134 -3 -166 -5z"/>\n  <path d="M10870 1910 c-16 -31 4 -62 38 -58 21 2 28 9 30 32 5 45 -47 65 -68\n  26z"/>\n  <path d="M10651 1703 c-56 -59 -101 -113 -101 -120 0 -28 172 -103 237 -103\n  l26 0 -7 123 c-10 179 -15 207 -36 207 -10 0 -63 -48 -119 -107z"/>\n  <path d="M11035 1801 c-7 -12 -23 -144 -29 -243 -4 -77 -4 -78 19 -78 45 0\n  130 22 193 51 l64 29 -19 23 c-65 82 -198 227 -209 227 -7 0 -15 -4 -19 -9z"/>\n  </g>\n  </svg>`}const s=async n=>(await fetch(`${t.garage}/${n}`)).json(),i=async n=>(await fetch(t.garage,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}})).json(),o=["BMW","Mercedes-Benz","Ford","Chevrolet","Mitsubishi","Nissan","Volvo","Audi","Toyota","Volkswagen"],c=["XT6","ZCT33","94","e34","o81","GT-311","NAZ","91j","Sa8AI","M0DE1"];function r(){const n=()=>Math.floor(256*Math.random());return`rgb(${n()}, ${n()}, ${n()})`}async function d(n){const e=document.getElementById(`start-engine-car-${n}`),a=document.getElementById(`stop-engine-car-${n}`);e instanceof HTMLButtonElement&&(e.disabled=!0,e.classList.toggle("enabling",!0));const{velocity:s,distance:i}=await(async n=>(await fetch(`${t.engine}?id=${n}&status=started`,{method:"PATCH"})).json())(n),o=Math.round(i/s);a instanceof HTMLButtonElement&&e instanceof HTMLButtonElement&&(e.classList.toggle("enabling",!1),a.disabled=!1);const c=document.getElementById(`car-${n}`);c instanceof HTMLElement&&(c.style.animationName="car-animation",c.style.animationDuration=`${o.toString()}ms`);const{success:r}=await(async n=>{const e=await fetch(`${t.engine}?id=${n}&status=drive`,{method:"PATCH"}).catch();return 200!==e.status?{success:!1}:{...await e.json()}})(n);return!r&&c instanceof HTMLElement&&(c.style.animationPlayState="paused",c.classList.add("broken")),{success:r,id:n,time:o}}async function l(n){const e=document.getElementById(`start-engine-car-${n}`),a=document.getElementById(`stop-engine-car-${n}`);a instanceof HTMLButtonElement&&(a.disabled=!0,a.classList.toggle("enabling",!0),await(async n=>(await fetch(`${t.engine}?id=${n}&status=stopped`,{method:"PATCH"})).json())(n),a.classList.toggle("enabling",!1),e instanceof HTMLButtonElement&&(e.disabled=!1));const s=document.getElementById(`car-${n}`);s instanceof HTMLElement&&(s.style.animationName="none",s.style.animationPlayState="initial",s.classList.remove("broken"))}async function u(n,t){const{success:a,id:s,time:i}=await Promise.race(n);if(!a){const e=t.findIndex((n=>n===s)),a=[...t.slice(0,e),...t.slice(e+1,t.length)];return u([...n.slice(0,e),...n.slice(e+1,n.length)],a)}return{...e.cars.find((n=>n.id===s)),time:+(i/1e3).toFixed(2)}}async function m(n){const t=e.cars.map((({id:t})=>n(t)));return await u(t,e.cars.map((n=>n.id)))}async function g(){const n=await(async(n,e=7)=>{const a=await fetch(`${t.garage}?_page=${n}&_limit=${e}`);return{items:await a.json(),count:Number(a.headers.get("X-Total-Count"))}})(e.garagePage);e.carsCount=n.count,e.cars=n.items}async function b(){const n=await(async({page:n,limit:e=1,sort:a,order:i})=>{const o=await fetch(`${t.winners}?_page=${n}&_limit=${e}${((n,t)=>n&&t?`&_sort=${n}&_order=${t}`:"")(a,i)}`),c=await o.json();return{items:await Promise.all(c.map((async n=>({...n,car:await s(n.id)})))),count:Number(o.headers.get("X-Total-Count"))}})({page:e.winnersPage,limit:10,sort:e.sort,order:e.sortOrder});e.winners=n.items,e.winnersCount=n.count}function w(){const n=document.getElementById("prev"),t=document.getElementById("next"),a=document.querySelector(".garage-menu-button"),s=document.querySelector(".winners-menu-button");"garage"===e.view?(a.disabled=!0,s.disabled=!1,e.garagePage>1?n.disabled=!1:n.disabled=!0,7*e.garagePage<e.carsCount?t.disabled=!1:t.disabled=!0):"winners"===e.view&&(a.disabled=!1,s.disabled=!0,e.winnersPage>1?n.disabled=!1:n.disabled=!0,10*e.winnersPage<e.winnersCount?t.disabled=!1:t.disabled=!0)}function p(){return`<div class="garage" id="garage">\n  <div class="garage__headers">\n    <h3>page: ${e.garagePage} /  ${Math.ceil(e.carsCount/7)}</h3>\n    <h3>garage: ${e.carsCount}</h3>    \n  </div>\n  <ul class="garage">\n    ${e.cars.map((n=>`<li>${(({id:n,name:t,color:e})=>`\n<div class="car">\n  <div class="car__top">\n    <div class="car__controls">\n      <button class="car__button button select-button" id="select-car-${n}">Select</button>\n      <button class="car__button button remove-button" id="remove-car-${n}">Remove</button>  \n      <button class="car__button start-engine-button" id="start-engine-car-${n}">Start</button>\n      <button class="car__button stop-engine-button" id="stop-engine-car-${n}" disabled>Stop</button>\n    </div>\n  <div class="car__name">${t}</div>\n  </div>\n  <div class="car__track">\n    <div class="car__image" id="car-${n}">${a(e)}</div>\n  </div>\n</div>\n`)(n)}</li>`)).join("")}\n  </ul>    \n</div>\n</div>`}const h=()=>`\n  <div class="winners__headers">\n    <h3>page: ${e.winnersPage} / ${Math.ceil(e.winnersCount/10)}</h2>\n    <h3>number of winners: ${e.winnersCount}</h1>\n  </div>\n  <table class="table" cellspasing="0" border="0" cellpadding="0">\n    <thead>\n      <th>Number</th>\n      <th>Car</th>\n      <th class="td-string">Name</th>\n      <th class="table-button table-wins ${"wins"===e.sort?e.sortOrder:""}" id="sort-by-wins">Wins</th>\n      <th class="table-button table-time ${"time"===e.sort?e.sortOrder:""}"" id="sort-by-time">Time(sec)</th>\n    </thead>\n    <tbody>\n      ${e.winners.map(((n,t)=>`<tr>\n        <td>${10*(e.winnersPage-1)+t+1}</td>\n        <td>${a(n.car.color)}</td>\n        <td class="td-string">${n.car.name}</td>\n        <td>${n.wins}</td>\n        <td>${n.time}</td></tr>`)).join("")}</tbody>\n  </table>\n`,y=function(){const n=document.getElementById("garage-cars"),a=document.getElementById("update-name"),u=document.getElementById("create-name"),y=document.getElementById("update-color"),$=document.getElementById("create-color"),M=document.getElementById("update-submit"),_=document.getElementById("update"),L=document.getElementById("create");let E=null;document.body.addEventListener("click",(async u=>{const $=u.target,_=document.getElementById("winners-view"),L=document.getElementById("garage-view"),T=document.getElementById("reset"),z=document.getElementById("race");if($.classList.contains("prev-button")&&("garage"===e.view?(e.garagePage-=1,await g(),w(),n&&(n.innerHTML=p())):(e.winnersPage-=1,await b(),w(),_.innerHTML=h())),$.classList.contains("next-button")&&("garage"===e.view?(e.garagePage+=1,await g(),w(),n&&(n.innerHTML=p())):(e.winnersPage+=1,await b(),w(),_.innerHTML=h())),$.classList.contains("garage-menu-button")&&(_.style.display="none",L.style.display="block",e.view="garage",w()),$.classList.contains("winners-menu-button")&&(_.style.display="block",L.style.display="none",await b(),_.innerHTML=h(),e.view="winners",w()),$.classList.contains("generator-button")){$.disabled=!0;const t=new Array(100).fill(1).map((()=>({name:`${o[Math.floor(Math.random()*o.length)]} ${c[Math.floor(Math.random()*c.length)]}`,color:r()})));await Promise.all(t.map((async n=>i(n)))),await g(),w(),n&&(n.innerHTML=p()),v(!1),$.disabled=!1}if($.classList.contains("select-button")&&(E=await s(+$.id.split("select-car-")[1]),a.value=E.name,y.value=E.color,a.disabled=!1,y.disabled=!1,M.disabled=!1),$.classList.contains("remove-button")){const e=+$.id.split("remove-car-")[1];await(async n=>(await fetch(`${t.garage}/${n}`,{method:"DELETE"})).json())(e),await(async n=>(await fetch(`${t.winners}/${n}`,{method:"DELETE"})).json())(e),await g(),n&&(n.innerHTML=p()),w()}if($.classList.contains("start-engine-button")&&d(+$.id.split("start-engine-car-")[1]),$.classList.contains("stop-engine-button")&&l(+$.id.split("stop-engine-car-")[1]),$.classList.contains("race-button")){v(!0),$.disabled=!0;const n=await m(d);await(async({id:n,time:e})=>{if(404===await(async n=>(await fetch(`${t.winners}/${n}`)).status)(n))await(async n=>(await fetch(t.winners,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}})).json())({id:n,wins:1,time:e});else{const a=await(async n=>(await fetch(`${t.winners}/${n}`)).json())(n);await(async(n,e)=>(await fetch(`${t.winners}/${n}`,{method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json())(n,{id:n,wins:a.wins+1,time:e<a.time?e:a.time})}})(n);const e=document.getElementById("message");e&&(e.innerHTML=`winner: ${n.name} - ${n.time}sec`,e.classList.toggle("visible",!0),setTimeout((()=>{e.classList.toggle("visible")}),7e3)),T.disabled=!1}$.classList.contains("reset-button")&&(v(!1),$.disabled=!0,e.cars.map((({id:n})=>l(n))),document.getElementById("message")?.classList.toggle("visible",!1),z.disabled=!1),$.classList.contains("table-wins")&&f("wins"),$.classList.contains("table-time")&&f("time")})),L.addEventListener("submit",(async t=>{if(t.preventDefault(),u.value){const t={name:u.value,color:$.value};await i(t),await g(),n&&(n.innerHTML=p()),w(),u.value="",$.value="#000000"}else alert("enter car name")})),_.addEventListener("submit",(async e=>{e.preventDefault();const s={name:a.value,color:y.value};E&&await(async(n,e)=>(await fetch(`${t.garage}/${n}`,{method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})).json())(E.id,s),await g(),n&&(n.innerHTML=p()),a.value="",a.disabled=!0,y.disabled=!0,y.value="#000000",M.disabled=!0,E=null}))};function v(n){const t=document.querySelectorAll(".primary");n?t.forEach((n=>n.disabled=!0)):w()}async function f(n){"asc"===e.sortOrder?e.sortOrder="desc":e.sortOrder="asc",e.sort=n,await b();const t=document.getElementById("winners-view");t&&(t.innerHTML=h())}!async function(){await g(),await(async()=>{const n=`\n    <header>\n        <h1>ASYNC-RACE</h1>\n        <nav class="navigation">\n          <button class="garage-menu-button navigation__item primary" id="garage-menu" disabled>> to garage</button>\n          <button class="winners-menu-button navigation__item primary" id="winners-menu">> to winners</button>\n        </nav>\n    </header>\n    <main>\n      <div class="wrapper" id="garage-view">\n        <div class="message" id="message"></div>  \n        <div class="garage-menu">\n          <form class="form" id="create">\n            <input type="text" class="form__name" id="create-name" name="name" placeholder="name of car">\n            <input type="color" class="form__color" id="create-color" name="color" value="#000000">\n            <button class="form__button">create</button>\n          </form>\n          <form class="form" id="update">\n            <input type="text" class="form__name" id="update-name" name="name" disabled dplaceholder="new name of car">\n            <input type="color" class="form__color" id="update-color" disabled name="color" value="#ffffff">\n            <button disabled class="form__button" id="update-submit">update</button>\n          </form>\n        </div>\n        <div class="race-controls buttons">\n          <button class="garage-menu__button race-button" id="race">race</button>\n          <button class="garage-menu__button reset-button" disabled id="reset">reset</button>\n          <button class="garage-menu__button generator-button" id="generator">generate</button>\n        </div>\n        <div id="garage-cars">\n          ${p()}\n        </div>\n      </div>\n      <div class="wrapper" id="winners-view" style="display: none">\n        ${h()}\n      </div>\n      <div class="pagination">\n        <button class="padination__button prev-button" disabled id="prev">prev</button>\n        <button class="padination__button next-button" disabled id="next">next</button>\n      </div>\n    </main>\n  `,t=document.createElement("div");t.innerHTML=n,document.body.appendChild(t)})(),w(),y()}()})()})();